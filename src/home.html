<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atom - Nueva pesta침a</title>
  <link rel="stylesheet" href="home.css">
</head>
<body>
  <div class="container">
    <div class="shortcuts-grid" id="shortcuts-grid">
      <!-- Los atajos se cargar치n din치micamente -->
      <div class="shortcut add-shortcut" id="add-shortcut-btn">
        <div class="shortcut-icon">+</div>
        <div class="shortcut-title">Add shortcut</div>
      </div>
    </div>
  </div>

  <!-- Modal para agregar atajo -->
  <div class="modal" id="add-modal">
    <div class="modal-content">
      <h2 class="modal-header">Add shortcut</h2>
      <form id="shortcut-form">
        <div class="form-group">
          <label class="form-label" for="shortcut-name">Name</label>
          <input type="text" id="shortcut-name" class="form-input" placeholder="e.g. Google" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="shortcut-url">URL</label>
          <input type="url" id="shortcut-url" class="form-input" placeholder="e.g. https://google.com" required>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="cancel-btn">Cancel</button>
          <button type="submit" class="btn btn-primary">Add</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const SHORTCUTS_KEY = 'atom-shortcuts';
    const shortcutsGrid = document.getElementById('shortcuts-grid');
    const addShortcutBtn = document.getElementById('add-shortcut-btn');
    const addModal = document.getElementById('add-modal');
    const shortcutForm = document.getElementById('shortcut-form');
    const cancelBtn = document.getElementById('cancel-btn');
    const nameInput = document.getElementById('shortcut-name');
    const urlInput = document.getElementById('shortcut-url');

    // Cargar atajos desde localStorage
    function loadShortcuts() {
      const shortcuts = JSON.parse(localStorage.getItem(SHORTCUTS_KEY) || '[]');
      return shortcuts;
    }

    // Guardar atajos en localStorage
    function saveShortcuts(shortcuts) {
      localStorage.setItem(SHORTCUTS_KEY, JSON.stringify(shortcuts));
    }

    // Obtener favicon de una URL
    function getFavicon(url) {
      try {
        const urlObj = new URL(url);
        return `https://www.google.com/s2/favicons?domain=${urlObj.hostname}&sz=64`;
      } catch {
        return '';
      }
    }

    // Renderizar atajos
    function renderShortcuts() {
      const shortcuts = loadShortcuts();

      // Limpiar grid (excepto el bot칩n de agregar)
      shortcutsGrid.innerHTML = '';

      // Agregar atajos
      shortcuts.forEach((shortcut, index) => {
        const shortcutEl = document.createElement('a');
        shortcutEl.className = 'shortcut';
        shortcutEl.href = shortcut.url;
        shortcutEl.setAttribute('data-index', index);

        const favicon = getFavicon(shortcut.url);

        shortcutEl.innerHTML = `
          <div class="shortcut-icon">
            <img src="${favicon}" alt="${shortcut.name}" onerror="this.style.display='none'; this.parentElement.textContent='游댕'">
          </div>
          <div class="shortcut-title">${shortcut.name}</div>
          <button class="delete-btn" onclick="deleteShortcut(${index}); event.preventDefault(); event.stopPropagation();">칑</button>
        `;

        shortcutsGrid.appendChild(shortcutEl);
      });

      // Agregar bot칩n de "Add shortcut" al final
      shortcutsGrid.appendChild(addShortcutBtn);
    }

    // Agregar atajo
    function addShortcut(name, url) {
      // Asegurar que la URL tenga protocolo
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'https://' + url;
      }

      const shortcuts = loadShortcuts();
      shortcuts.push({ name, url });
      saveShortcuts(shortcuts);
      renderShortcuts();
    }

    // Eliminar atajo
    function deleteShortcut(index) {
      const shortcuts = loadShortcuts();
      shortcuts.splice(index, 1);
      saveShortcuts(shortcuts);
      renderShortcuts();
    }

    // Hacer deleteShortcut global
    window.deleteShortcut = deleteShortcut;

    // Mostrar modal
    addShortcutBtn.addEventListener('click', () => {
      addModal.classList.add('active');
      nameInput.focus();
    });

    // Cerrar modal
    cancelBtn.addEventListener('click', () => {
      addModal.classList.remove('active');
      shortcutForm.reset();
    });

    // Cerrar modal al hacer clic fuera
    addModal.addEventListener('click', (e) => {
      if (e.target === addModal) {
        addModal.classList.remove('active');
        shortcutForm.reset();
      }
    });

    // Manejar env칤o del formulario
    shortcutForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const url = urlInput.value.trim();

      if (name && url) {
        addShortcut(name, url);
        addModal.classList.remove('active');
        shortcutForm.reset();
      }
    });

    // Cerrar modal con ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && addModal.classList.contains('active')) {
        addModal.classList.remove('active');
        shortcutForm.reset();
      }
    });

    // Inicializar
    renderShortcuts();

    // Si no hay atajos, agregar algunos por defecto
    if (loadShortcuts().length === 0) {
      const defaultShortcuts = [
        { name: 'Google', url: 'https://google.com' },
        { name: 'YouTube', url: 'https://youtube.com' },
        { name: 'GitHub', url: 'https://github.com' },
      ];
      saveShortcuts(defaultShortcuts);
      renderShortcuts();
    }
  </script>
</body>
</html>
